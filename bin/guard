#!/usr/bin/env ruby

def ignore_interrupts(*args)
  args.unshift(RbConfig.ruby) if Gem.win_platform?
  pid = spawn(*args)
  begin
    Process.wait(pid)
  rescue Interrupt
    retry
  end
  $? == 0
end

guard_core_path = Gem.bin_path("guard", "_guard-core")
while !ignore_interrupts(guard_core_path, *ARGV) && $?.exitstatus == 2
  puts("Restarting guard...")
end
exit($?.exitstatus)
